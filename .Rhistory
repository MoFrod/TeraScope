setwd("D:/Morgan/Documents/NCL MSc/EDA/Test"
load.project("cashflow_analysis")
setwd("D:/Morgan/Documents/NCL MSc/EDA/Test"
setwd("D:/Morgan/Documents/NCL MSc/EDA/Test")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
library(ProjectTemplate)
load.project()
# Convert timestamp values to date/time
as_datetime(AC1%timestamp)
# Convert timestamp values to date/time
as_datetime(AC1$timestamp)
setwd("D:/Morgan/Documents/NCL MSc/CC/CSC8634_TeraScope_210431461")
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir= normalizePath('..'))
library(ProjectTemplate)
load.project()
# How many unique hostnames are there?
hosts <- AC1 %>%
group_by(hostname) %>%
summarise (n_distinct(hostname)) %>%
count()
# How many GPU serials are there?
gserials <- GPU1 %>%
group_by(gpuSerial) %>%
summarise(n_distinct(gpuSerial)) %>%
count()
# How many times does TotalRender happen per host?
TRh <- AC1 %>%
filter(eventName == "TotalRender") %>%
count() %>%
as_tibble() %>%
arrange(desc(n), .by_group = FALSE)
# How many taskIds are there?
ID <- AC1 %>%
group_by(taskId) %>%
summarise(n_distinct(taskId)) %>%
count() %>%
print() # This is the same in both application.checkpoints and task.x.y
# How many jobIds are there?
j <- AC1 %>%
group_by(jobId) %>%
summarise(n_distinct(jobId)) %>%
count() %>%
print() # This is the same in both application.checkpoints and task.x.y, and corresponds to the levels 4, 8 and 12
# Display AC2 with START, STOP and duration as columns (Code to create AC2 is in the munge folder)
print(AC2, n = 6, width = Inf)
# Plot duration of eventName
ggplot(AC2, aes(x = eventName, y = duration)) + geom_boxplot(alpha = 0.3, color = "#1f78b4") + labs(x = "Name of Event", y = "Duration (seconds)", title = "Boxplot of Duration by Name of Event") + theme(legend.position = "none") + expand_limits(y = 0)
# Remove Total Render from results
AC3 <- AC2 %>%
filter(eventName != "TotalRender")
# Plot duration of eventName activities without total render
ggplot(AC3, aes(x = eventName, y = duration)) + geom_boxplot(alpha = 0.3, color = "#1f78b4") + labs(x = "Name of Event", y = "Duration (seconds)", title = "Boxplot of Duration by Name of Event without TotalRender") + theme(legend.position = "none") + expand_limits(y = 0)
# Which hosts have the longest Render time?
AC6 <- AC3 %>%
filter(eventName == "Render") %>%
arrange(desc(duration)) # Arrange so longest duration is at the top
R_long <- head(AC6, 50) %>%
group_by(hostname) %>% # Isolate the 50 longest durations
print(., n = 5, width = Inf)
# Create a single data set with power usage and duration for every event other than total render
BEGIN <- as_datetime("2018-11-0807:41:27.242", tz = "Europe/London") # We're interested in timestamps after this time
END <- as_datetime("2018-11-0807:42:27.242", tz = "Europe/London") # We're interested in timestamps before this time
AC9 <- AC2 %>%
filter(START >= BEGIN, START <= END) %>% # Select start times between BEGIN and END
mutate(timestamp = round_date(START, unit = "2 seconds")) # Create new timestamp column where start time is rounded to the nearest 15 seconds
GPU2 <- GPU1 %>%
filter(timestamp >= BEGIN, timestamp <= END) %>% # Select timestamp that is between BEGIN and END
mutate(timestamp = round_date(timestamp, unit = "2 seconds")) # Alter the timestamp column so that it is rounded to the nearest 15 seconds
Power_Duration2 <- full_join(AC9, GPU2, by = c("timestamp", "hostname")) %>% # Join AC9 and GPU2
na.omit() %>% # Omit rows with NA
group_by(hostname) %>% # Group by hostname
arrange(timestamp, .by_group = TRUE) # Arrange by timestamp
# Plot event name by power draw
ggplot(Power_Duration2, aes(x = eventName, y = powerDrawWatt)) + geom_boxplot(alpha = 0.3, color = "#33a02c") + labs(x = "Name of Event", y = "Power Draw (watts)", title = "Boxplot of Power Draw by Name of Event") + theme(legend.position = "none") + expand_limits(y = 0)
# Plot hostname by power draw and duration of tiling
Power_Duration2 %>%
filter(eventName == "Tiling") %>%
ggplot(aes(x = duration, y = powerDrawWatt, color = jobId)) + geom_point(position = "jitter") + labs(x = "Duration (seconds)", y = "Power Draw (watts)", title = "Tiling: Power Draw by Duration", color = "Job ID") + scale_color_brewer(palette = "Paired")
# Plot hostname by power draw and duration of uploading
Power_Duration2 %>%
filter(eventName == "Uploading") %>%
ggplot(aes(x = duration, y = powerDrawWatt, color = jobId)) + geom_point(position = "jitter") + labs(x = "Duration (seconds)", y = "Power Draw (watts)", title = "Uploading: Power Draw by Duration", color = "Job ID") + scale_color_brewer(palette = "Paired")
# Plot hostname by power draw and duration of total render
Power_Duration2 %>%
filter(eventName == "TotalRender") %>%
ggplot(aes(x = duration, y = powerDrawWatt, color = jobId)) + geom_point(position = "jitter") + labs(x = "Duration (seconds)", y = "Power Draw (watts)", title = "TotalRender: Power Draw by Duration", color = "Job ID") + scale_color_brewer(palette = "Paired")
# What is the mean, standard deviation and coefficient of variation for Total Render duration?
AC7 <- AC2 %>%
filter(eventName == "TotalRender") # Filter to create a new data set only with TotalRender
TR1 <- AC7 %>%
group_by(hostname) %>% # Group by the virtual machine host name
summarise(av_duration = mean(duration), sd_duration = sd(duration)) %>% # Calculate mean and standard deviation of duration for each host.
mutate(CoV = (sd_duration/av_duration)*100) # New column with coefficient of variation
# What is the mean, standard deviation and coefficient of variation for GPU power draw?
Power <- GPU1 %>%
group_by(hostname) %>% # Group by hostname
summarise(av_power = mean(powerDrawWatt), sd_power = sd(powerDrawWatt)) %>% # Calculate mean and standard deviation of power for each host.
mutate(CoV_p = (sd_power/av_power)*100) # New column with coefficient of variation
# Create single data set to compare execution time and power draw.
Power_Duration <- left_join(TR1, Power, by = "hostname")
# Plot average power draw by average duration for each hostname
Power_Duration %>%
ggplot(aes(x = av_duration, y = av_power)) + geom_point(position = "jitter", color = "#33a02c") + geom_smooth(color = "#525252") + labs(x = "Average Duration (seconds)", y = "Average Power Draw (watts)", title = "Hostname: Average Power Draw by Average Duration") + expand_limits(y = 80)
# What is the mean, standard deviation and coefficient of variation for all GPU metrics by host
Performance <- GPU1 %>%
group_by(hostname) %>% # Group by hostname
summarise(av_power = mean(powerDrawWatt), sd_power = sd(powerDrawWatt), av_temp = mean(gpuTempC), sd_temp = sd(gpuTempC), av_util = mean(gpuUtilPerc), sd_util = sd(gpuUtilPerc), av_mem = mean(gpuMemUtilPerc), sd_mem = sd(gpuMemUtilPerc)) %>% # Calculate mean and standard deviation of power for each host.
mutate(CoV_p = (sd_power/av_power)*100, CoV_t = (sd_temp/av_temp)*100, CoV_u = (sd_util/av_util)*100, CoV_m = (sd_mem/av_mem)*100) # New column with coefficient of variation
# Plot power by temperature
Performance %>%
ggplot(aes(x = av_temp, y = av_power, color = CoV_t)) + geom_point(position = "jitter") + geom_smooth(color = "#525252") + labs(x = "Average Temperature (celcius)", y = "Average Power Draw (watts)", title = "Hostname: Average Power Draw by Average Temperature", color = "Temperature Coefficient of Variation") # Temperature is loosely correlated to power; temperature seems to increase as you use more power
# Plot power by util
Performance %>%
ggplot(aes(x = av_util, y = av_power, color = CoV_u)) + geom_point(position = "jitter") + geom_smooth(color = "#525252") + labs(x = "Average Utilisation (percentage)", y = "Average Power Draw (watts)", title = "Hostname: Average Power Draw by Average Core Utilisation", color = "Utilisation Coefficent of Variation")
# Plot power by mem
Performance %>%
ggplot(aes(x = av_mem, y = av_power, color = CoV_m)) + geom_point(position = "jitter") + geom_smooth(color = "#525252") + labs(x = "Average Memory (percentage)", y = "Average Power Draw (watts)", title = "Hostname: Average Power Draw by Average Memory Usage") # Power use generally increases as more gpu memory is used - you see a clear divide into two groups here.
# Plot mem by util
Performance %>%
ggplot(aes(x = av_mem, y = av_util, color = CoV_m)) + geom_point(position = "jitter") + geom_smooth(color = "#525252") + labs(x = "Average Memory (percentage)", y = "Average Utilisation (percentage)", title = "Hostname: Average Utilisation by Average Memory Usage") # Very clear trajectory of more memory corresponds to utilising  more gpu core
# Create a heatmap co-ordinates from XY1 with colour as Total Render time
T1 <- AC7[, c("taskId", "duration")] # Create new tibble with taskId and duration time
TR2 <- left_join(T1, XY1, by = "taskId") # Join together T1 and XY1
TR2 %>%
ggplot(aes(x = x, y = y, fill = duration)) + geom_tile() # Surfaces with intense texture take more time to render, for example stadium seats and roofs with different surfaces such as satelites.
# Filter out gpu cards that have the longest duration
Power_Duration3 <- Power_Duration2 %>%
group_by(gpuSerial) %>%
mutate(av_gpu_t = mean(duration))
S_gpu <- Power_Duration3 %>%
filter(av_gpu_t >= 34) %>%
arrange(desc(av_gpu_t)) %>%
head(10)
# Witing data for Matt support
write.csv(TR1, "TR1.csv") # Copy for Matt support
write.csv(Performance, "Performance.csv") # Copy for Matt support
write.csv(GPU1, "GPU1.csv") # Copy for Matt support
write.csv(Power_Duration2, "Power_Duration2.csv") # Copy for Matt support
# Filter out gpu cards that have the longest duration
Power_Duration3 <- Power_Duration2 %>%
group_by(gpuSerial) %>%
mutate(av_gpu_t = median(duration))
S_gpu <- Power_Duration3 %>%
filter(av_gpu_t >= 34) %>%
arrange(desc(av_gpu_t)) %>%
head(10)
View(S_gpu)
View(Power_Duration2)
# Filter out gpu cards that have the longest duration
Power_Duration3 <- Power_Duration2 %>%
filter(eventName == "TotalRender") %>%
group_by(gpuSerial) %>%
mutate(av_gpu_t = median(duration))
S_gpu <- Power_Duration3 %>%
filter(av_gpu_t >= 34) %>%
arrange(desc(av_gpu_t)) %>%
head(10)
# Filter out gpu cards that have the longest duration
Power_Duration3 <- Power_Duration2 %>%
filter(eventName == "TotalRender") %>%
group_by(gpuSerial) %>%
mutate(med_gpu_t = median(duration))
S_gpu <- Power_Duration3 %>%
filter(med_gpu_t >= 34) %>%
arrange(desc(med_gpu_t)) %>%
head(10)
View(Power_Duration3)
